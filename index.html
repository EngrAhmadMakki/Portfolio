<!DOCTYPE html>
<!-- scroll-smooth enables smooth scrolling for anchor links -->
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO & Social Meta Tags -->
    <title>Ahmad Makki | AI/ML Engineer</title>
    <meta name="description" content="Portfolio of Ahmad Makki, an AI/ML Engineer specializing in Computer Vision, NLP, LLM Apps, and MLOps.">
    <meta property="og:title" content="Ahmad Makki | AI/ML Engineer Portfolio">
    <meta property="og:description" content="Explore my projects in real-time computer vision, generative AI, and MLOps using Python, Docker, and Kubernetes.">
    <meta property="og:image" content="Ahmad_Makki_Pic.jpeg"> <!-- Needs to be an absolute URL when hosted -->
    
    <!-- Favicon (Base64 encoded SVG) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ¤–</text></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Calendly Embed Styles -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    
    <!-- TensorFlow.js & COCO-SSD Model -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@latest/dist/coco-ssd.min.js"></script>

    <!-- NEW: Extra TFJS models (all run in-browser, no backend needed) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/toxicity@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@latest"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #e2e8f0; /* slate-200 */
            -webkit-font-smoothing: antialiased;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background-color: #1e293b; /* slate-800 */
        }
        ::-webkit-scrollbar-thumb {
            background-color: #06b6d4; /* cyan-500 */
            border-radius: 0.5rem;
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: #22d3ee; /* cyan-400 */
        }
        
        /* Icon helpers */
        .icon-lg {
            width: 3rem;
            height: 3rem;
            stroke-width: 1.5;
            margin-bottom: 0.5rem;
        }
        .icon-sm {
            width: 1.25rem;
            height: 1.25rem;
            stroke-width: 2;
            flex-shrink: 0;
        }
        
        /* Fade-in load animation */
        .fade-in-load {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.7s ease-out, transform 0.7s ease-out;
        }
        .fade-in-load.loaded {
            opacity: 1;
            transform: translateY(0);
        }

        /* Active Nav Link Style for Scrollspy */
        .nav-link.active {
            color: rgb(34 211 238); /* text-cyan-400 */
        }
        
        /* Chatbot typing dots */
        .typing-dot {
            width: 0.375rem;
            height: 0.375rem;
            background-color: #94a3b8; /* slate-400 */
            border-radius: 9999px;
            display: inline-block;
            animation: pulse 1s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Hide scrollbar for chat messages, but allow scrolling */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Pretty file input */
        input[type="file"]::file-selector-button {
            background-color: #334155; /* slate-700 */
            color: #cbd5e1; /* slate-300 */
            font-weight: 500;
            font-size: 0.875rem;
            line-height: 1.25rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #475569; /* slate-600 */
            margin-right: 1rem;
            cursor: pointer;
            transition: all .15s;
        }
        input[type="file"]::file-selector-button:hover {
            background-color: #475569; /* slate-600 */
        }
        input[type="file"] {
            color: #94a3b8; /* slate-400 */
            font-size: 0.875rem;
        }

        /* AI avatar "thinking" pulse ring */
        @keyframes pulseRing {
            0%   { box-shadow: 0 0 8px 2px rgba(34,211,238,0.6); opacity: 1; }
            70%  { box-shadow: 0 0 20px 8px rgba(34,211,238,0); opacity: 0; }
            100% { box-shadow: 0 0 8px 2px rgba(34,211,238,0); opacity: 0; }
        }
        .ai-thinking {
            animation: pulseRing 1.5s infinite;
        }
        
        /* AI avatar "speaking" pulse shadow */
        @keyframes pulseShadow {
            0%, 100% { box-shadow: 0 0 10px 2px rgba(34, 211, 238, 0.3); }
            50% { box-shadow: 0 0 16px 6px rgba(34, 211, 238, 0.7); }
        }
        .ai-speaking {
            animation: pulseShadow 1.2s ease-in-out infinite;
        }
        #ai-avatar-img {
             box-shadow: 0 0 10px 2px rgba(34, 211, 238, 0.0);
             transition: box-shadow 0.3s ease;
        }

        /* Ambient glow behind chatbot */
        @keyframes pulseSlow {
            0%   { opacity: .4; filter: blur(40px); }
            50%  { opacity: .7; filter: blur(60px); }
            100% { opacity: .4; filter: blur(40px); }
        }
        .animate-pulse-slow {
            animation: pulseSlow 4s ease-in-out infinite;
        }

        /* Floating robot base position + float animation */
        #floating-robot {
            bottom: 7rem;        /* initial position */
            right: 1.5rem;
            z-index: 70;
            animation: robotFloat 4s ease-in-out infinite;
            transition:
                top 0.4s ease,
                bottom 0.4s ease,
                left 0.4s ease,
                right 0.4s ease,
                transform 0.3s ease,
                box-shadow 0.3s ease;
        }

        #floating-robot:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 0 25px rgba(34, 211, 238, 0.8);
        }

        /* gentle floating */
        @keyframes robotFloat {
            0%, 100% { transform: translateY(0); }
            50%      { transform: translateY(-6px); }
        }

        /* quick jump effect when moving to new section */
        .robot-jump {
            animation: robotJump 0.35s ease-out;
        }

        @keyframes robotJump {
            0%   { transform: scale(0.8) translateY(8px); opacity: 0.4; }
            60%  { transform: scale(1.1) translateY(-4px); opacity: 1; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        /* Fun: wave the right arm a bit */
        #robot-arm-right {
            transform-origin: 60px 44px; /* adjust if wave looks weird */
            animation: robotWave 2.6s ease-in-out infinite 1s;
        }

        @keyframes robotWave {
            0%, 100% { transform: rotate(0deg); }
            40%      { transform: rotate(10deg); }
            50%      { transform: rotate(-4deg); }
            60%      { transform: rotate(8deg); }
        }

        /* NEW: Robot eye animations */
        @keyframes robotBlink {
            0%, 95%, 100% { opacity: 1; }
            98% { opacity: 0; }
        }
        #robot-eye-left, #robot-eye-right {
            animation: robotBlink 5s ease-in-out infinite 2s; /* Slow, natural blink */
        }
        
        .robot-active #robot-eye-left,
        .robot-active #robot-eye-right {
            fill: #22d3ee; /* Glow cyan */
            animation: robotBlink 1.2s ease-in-out infinite; /* Fast, active blink */
        }

    </style>
</head>
<body class="bg-slate-900 text-slate-200">

    <!-- Header & Navigation -->
    <header class="sticky top-0 z-50 w-full bg-slate-900/80 backdrop-blur-lg border-b border-slate-700/50">
        <nav class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo / Name -->
                <div class="flex-shrink-0 flex items-center">
                    <a href="#" class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-500">
                        Ahmad Makki
                    </a>
                    <span class="ml-2 inline-flex items-center text-[10px] font-semibold text-cyan-400 bg-cyan-500/10 border border-cyan-500/30 rounded-full px-2 py-[2px] leading-none tracking-wide">
                        AI-Powered
                    </span>
                </div>
                
                <!-- Desktop Navigation Links -->
                <div class="hidden sm:flex sm:items-center sm:ml-6 space-x-4">
                    <a href="#about" class="nav-link text-slate-300 hover:text-white hover:bg-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">About</a>
                    <a href="#skills" class="nav-link text-slate-300 hover:text-white hover:bg-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Skills</a>
                    <a href="#experience" class="nav-link text-slate-300 hover:text-white hover:bg-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Experience</a>
                    <a href="#projects" class="nav-link text-slate-300 hover:text-white hover:bg-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Projects</a>
                    <!-- AI Playground Link -->
                    <a href="#ai-playground" class="nav-link text-slate-300 hover:text-white hover:bg-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">AI Demo</a>
                    <a href="#appointment" class="nav-link text-slate-300 hover:text-white hover:bg-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Book a Call</a>
                    <a href="#gettintouch" class="nav-link text-slate-300 hover:text-white hover:bg-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Get in Touch</a>
                    
                    <!-- NOTE: keep AhmadMakki_AI-ML_Engineer.pdf in the same folder -->
                    <a href="AhmadMakki_AI-ML_Engineer.pdf" download="Ahmad_Makki_Resume.pdf" class="text-cyan-400 border border-cyan-500/50 hover:bg-cyan-500 hover:text-slate-900 hover:border-cyan-500 font-medium px-4 py-2 rounded-md text-sm transition transform hover:scale-105 duration-300">
                        Resume
                    </a>
                </div>
                
                <!-- Mobile menu button -->
                <div class="sm:hidden flex items-center gap-2">
                    <button id="mobile-menu-button" type="button" class="text-slate-400 hover:text-white focus:outline-none" aria-label="Toggle menu">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden sm:hidden bg-slate-900 py-4 space-y-2">
                <a href="#about" class="nav-link block text-slate-300 hover:bg-slate-800 hover:text-white px-3 py-2 rounded-md text-base font-medium transition-colors">About</a>
                <a href="#skills" class="nav-link block text-slate-300 hover:bg-slate-800 hover:text-white px-3 py-2 rounded-md text-base font-medium transition-colors">Skills</a>
                <a href="#experience" class="nav-link block text-slate-300 hover:bg-slate-800 hover:text-white px-3 py-2 rounded-md text-base font-medium transition-colors">Experience</a>
                <a href="#projects" class="nav-link block text-slate-300 hover:bg-slate-800 hover:text-white px-3 py-2 rounded-md text-base font-medium transition-colors">Projects</a>
                <!-- AI Playground Link -->
                <a href="#ai-playground" class="nav-link block text-slate-300 hover:bg-slate-800 hover:text-white px-3 py-2 rounded-md text-base font-medium transition-colors">AI Demo</a>
                <a href="#appointment" class="nav-link block text-slate-300 hover:bg-slate-800 hover:text-white px-3 py-2 rounded-md text-base font-medium transition-colors">Book a Call</a>
                <a href="#gettintouch" class="nav-link block text-slate-300 hover:bg-slate-800 hover:text-white px-3 py-2 rounded-md text-base font-medium transition-colors">Get in Touch</a>
                <a href="AhmadMakki_AI-ML_Engineer.pdf" download="Ahmad_Makki_Resume.pdf" class="block text-cyan-400 border border-cyan-500/50 hover:bg-cyan-500 hover:text-slate-900 text-center px-4 py-2 rounded-md text-base font-medium transition-all duration-300 mt-2 mx-3">
                    Download Resume
                </a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Hero Section -->
        <section id="hero" class="pt-24 pb-16 md:pt-32 md:pb-24">
            <div class="flex flex-col-reverse md:flex-row items-center justify-between gap-8">
                <!-- Text Content -->
                <div class="text-center md:text-left fade-in-load">
                    <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight">
                        <span class="block text-slate-100">Ahmad Makki</span>
                        <span class="block bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-500 mt-2 min-h-[4rem] md:min-h-[5.5rem]">
                            <span id="typing-effect">AI/ML Engineer</span>
                        </span>
                    </h1>
                    <p class="mt-4 max-w-2xl text-lg md:text-xl text-slate-400">
                        Computer Vision â€¢ NLP â€¢ LLM Apps â€¢ MLOps
                    </p>
                    <p class="mt-2 max-w-2xl text-md text-slate-500">
                        Lahore District, Punjab, Pakistan
                    </p>
                    <div class="mt-8 flex justify-center md:justify-start gap-4">
                        <!-- Contact Link -->
                        <a href="#gettintouch" class="inline-flex items-center gap-2 bg-cyan-500 text-slate-900 font-bold px-6 py-3 rounded-lg text-base shadow-lg hover:bg-cyan-400 transition-all duration-300 transform hover:scale-105">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                            Contact Me
                        </a>
                        <!-- Resume Link -->
                        <a href="AhmadMakki_AI-ML_Engineer.pdf" download="Ahmad_Makki_Resume.pdf" rel="noopener noreferrer" class="inline-flex items-center gap-2 bg-slate-800 text-slate-300 border border-slate-700 font-medium px-6 py-3 rounded-lg text-base shadow-lg hover:bg-slate-700 hover:text-white transition-all duration-300 transform hover:scale-105">
                             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                            View Resume
                        </a>
                    </div>
                    <div class="mt-8 flex justify-center md:justify-start gap-6">
                        <a href="https://github.com/EngrAhmadMakki" target="_blank" rel="noopener noreferrer" class="text-slate-400 hover:text-cyan-400 transition-all" aria-label="GitHub">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-1.5 6-6.5a5.5 5.5 0 0 0-1.5-4A5 5 0 0 0 18 2h-3a4 4 0 0 0-4 4v.5A5.5 5.5 0 0 0 9.5 11c0 5 3 6.5 6 6.5-1 1-1.5 2.5-1.5 3.5V22"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                        </a>
                        <a href="https://linkedin.com/in/EngrAhmadMakki" target="_blank" rel="noopener noreferrer" class="text-slate-400 hover:text-cyan-400 transition-all" aria-label="LinkedIn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></svg>
                        </a>
                    </div>
                </div>
                <!-- Image -->
                <div class="flex-shrink-0 fade-in-load" style="transition-delay: 200ms;">
                    <video 
                        src="Talking_Head_Avatar_Generation.mp4" 
                        autoplay 
                        loop 
                        muted 
                        playsinline
                        class="w-48 h-48 md:w-64 md:h-64 rounded-full object-cover shadow-2xl shadow-cyan-500/20 border-4 border-slate-700"
                    >
                        Your browser does not support the video tag.
                    </video>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <!-- (unchanged, keeping your content as-is) -->
        <!-- ... YOUR ABOUT, SKILLS, EXPERIENCE, PROJECTS, etc. SECTIONS HERE ... -->
        <!-- I am keeping them exactly as you pasted, only skipping in this explanation for length -->

        <!-- Projects Section (unchanged) -->
        <!-- ... -->

        <!-- AI Playground Section -->
        <section id="ai-playground" class="py-16 md:py-24">
            <div class="text-center">
                <h2 class="text-3xl font-bold tracking-tight text-slate-100 sm:text-4xl">AI Playground</h2>
                <p class="mt-4 text-lg text-cyan-400">Live In-Browser AI Demo</p>
                <p class="mt-2 text-sm text-slate-400 max-w-xl mx-auto">
                    This demo uses TensorFlow.js to run AI models entirely in your browser. Nothing is sent to a server.
                </p>
            </div>

            <!-- Existing Webcam Object Detection Demo (unchanged) -->
            <div class="mt-12 max-w-2xl mx-auto bg-slate-800/50 p-6 rounded-2xl shadow-xl border border-slate-700/50">
                <div class="text-center mb-4">
                    <button id="webcam-button" class="inline-flex items-center gap-2 bg-cyan-500 text-slate-900 font-bold px-6 py-3 rounded-lg text-base shadow-lg hover:bg-cyan-400 transition-all duration-300 transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-camera"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>
                        Start Webcam
                    </button>
                    <p id="model-status" class="text-sm text-slate-500 mt-3 h-4"></p>
                </div>
                <div class="relative w-full aspect-video bg-slate-900 rounded-lg overflow-hidden border border-slate-700">
                    <video id="webcam-feed" autoplay muted playsinline class="w-full h-full object-cover"></video>
                    <canvas id="detection-canvas" class="absolute top-0 left-0 w-full h-full"></canvas>
                </div>
            </div>

            <!-- NEW: Extra AI Demos (Image Classification, Tone Analyzer, Topic Router) -->
            <div class="mt-10 max-w-4xl mx-auto grid md:grid-cols-2 gap-6">
                <!-- Image Classification Demo -->
                <div class="bg-slate-800/50 p-5 rounded-2xl shadow-xl border border-slate-700/50">
                    <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                        1. Image Classifier (MobileNet)
                    </h3>
                    <p class="text-xs text-slate-400 mb-3">
                        Upload any image and a pre-trained MobileNet model will guess what it is.
                    </p>
                    <input type="file" id="classify-image-input" accept="image/*" class="mb-3 w-full">
                    <div class="flex items-center gap-3 mb-3">
                        <img id="classify-image-preview" class="w-20 h-20 rounded-lg object-cover border border-slate-700 hidden" alt="Preview">
                        <button id="classify-image-button"
                                class="bg-cyan-500 text-slate-900 font-semibold px-4 py-2 rounded-lg text-xs hover:bg-cyan-400 transition disabled:opacity-40 disabled:cursor-not-allowed">
                            Classify Image
                        </button>
                    </div>
                    <p id="classify-image-result" class="text-sm text-slate-300 min-h-[1.5rem]"></p>
                </div>

                <!-- Tone Analyzer Demo -->
                <div class="bg-slate-800/50 p-5 rounded-2xl shadow-xl border border-slate-700/50">
                    <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                        2. Tone Analyzer (Toxicity Model)
                    </h3>
                    <p class="text-xs text-slate-400 mb-3">
                        Type a sentence and the model will check if the tone is neutral or possibly toxic.
                    </p>
                    <textarea id="tone-input"
                              rows="3"
                              class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700 text-slate-200 text-sm mb-3"
                              placeholder="Example: This idea is absolutely terrible..."></textarea>
                    <button id="tone-analyze-button"
                            class="bg-cyan-500 text-slate-900 font-semibold px-4 py-2 rounded-lg text-xs hover:bg-cyan-400 transition disabled:opacity-40 disabled:cursor-not-allowed">
                        Analyze Tone
                    </button>
                    <p id="tone-result" class="mt-3 text-sm text-slate-300 min-h-[1.5rem]"></p>
                </div>

                <!-- Smart Topic Router Demo (full width) -->
                <div class="md:col-span-2 bg-slate-800/50 p-5 rounded-2xl shadow-xl border border-slate-700/50">
                    <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                        3. Smart Topic Router (NLP)
                    </h3>
                    <p class="text-xs text-slate-400 mb-3">
                        Type your question, and a Universal Sentence Encoder model will guess which of Ahmadâ€™s domains it belongs to:
                        <span class="text-cyan-300">Computer Vision</span>, 
                        <span class="text-cyan-300">LLMs / NLP</span>, or 
                        <span class="text-cyan-300">MLOps & Deployment</span>.
                    </p>
                    <textarea id="route-input"
                              rows="2"
                              class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-700 text-slate-200 text-sm mb-3"
                              placeholder="Example: I want to deploy a YOLO model on Kubernetes."></textarea>
                    <button id="route-button"
                            class="bg-cyan-500 text-slate-900 font-semibold px-4 py-2 rounded-lg text-xs hover:bg-cyan-400 transition disabled:opacity-40 disabled:cursor-not-allowed">
                        Detect Relevant Skill Area
                    </button>
                    <p id="route-result" class="mt-3 text-sm text-slate-300 min-h-[1.5rem]"></p>
                </div>
            </div>
        </section>

        <!-- Education, Certifications, Posts, Appointment, Get in Touch sections -->
        <!-- (all unchanged from your original code) -->
        <!-- ... -->

    </main>

    <!-- Footer (unchanged) -->
    <!-- ... your footer code exactly as before ... -->

    <!-- Floating AI Robot Mascot -->
    <!-- (unchanged) -->
    <!-- ... your robot SVG and chatbot widget code exactly as before ... -->

    <!-- Calendly Embed Script -->
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>

    <!-- AUDIO CONVERSION SCRIPT (unchanged) -->
    <!-- ... base64ToArrayBuffer + pcmToWav ... -->

    <!-- MAIN PAGE SCRIPT -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Mobile Menu Toggle ---
            const menuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            menuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // --- Hero Typing Effect ---
            const typingElement = document.getElementById('typing-effect');
            if (typingElement) {
                const roles = [
                    "AI/ML Engineer",
                    "Computer Vision Engineer",
                    "LLM & Automation Engineer",
                    "MLOps Engineer"
                ];
                let roleIndex = 0;
                let charIndex = 0;
                let isDeleting = false;

                function type() {
                    const currentRole = roles[roleIndex];
                    let displayText = '';

                    if (isDeleting) {
                        displayText = currentRole.substring(0, charIndex - 1);
                        charIndex--;
                    } else {
                        displayText = currentRole.substring(0, charIndex + 1);
                        charIndex++;
                    }

                    typingElement.textContent = displayText;

                    let typeSpeed = 100;
                    if (isDeleting) typeSpeed /= 2;

                    if (!isDeleting && charIndex === currentRole.length) {
                        typeSpeed = 2000; // pause full word
                        isDeleting = true;
                    } else if (isDeleting && charIndex === 0) {
                        isDeleting = false;
                        roleIndex = (roleIndex + 1) % roles.length;
                        typeSpeed = 500; // pause before next word
                    }

                    setTimeout(type, typeSpeed);
                }
                type();
            }

            // --- Simple Fade-in Animation on Load ---
            const elementsToFadeIn = document.querySelectorAll('.fade-in-load');
            elementsToFadeIn.forEach(el => {
                setTimeout(() => {
                    el.classList.add('loaded');
                }, 100);
            });
            
            // --- Scrollspy for Nav Links ---
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.nav-link');
            const headerOffset = 80; // sticky header height

            function onScroll() {
                let currentSection = '';
                const scrollPos = window.scrollY + headerOffset;

                sections.forEach(section => {
                    if (section && typeof section.offsetTop !== 'undefined') {
                        if (scrollPos >= section.offsetTop) {
                            currentSection = section.getAttribute('id');
                        }
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${currentSection}`) {
                        link.classList.add('active');
                    }
                });
            }
            window.addEventListener('scroll', onScroll);
            onScroll(); // run once

            // --- Floating Robot: MakkiBot 1.0 ---
            const robot = document.getElementById('floating-robot');
            if (robot) {
                const robotStops = [
                    { 
                        sectionId: 'hero',
                        align: 'right', 
                        offsetY: 120, 
                        title: "Welcome! Ahmad upgraded me from console.log to real life. ðŸ¤–" 
                    },
                    { 
                        sectionId: 'skills',
                        align: 'left',  
                        offsetY: 100,
                        title: "Skills section â€“ ab thora serious ho jaata hoon."
                    },
                    { 
                        sectionId: 'projects',
                        align: 'right', 
                        offsetY: 160,
                        title: "Yeh projects dekh kar GPUs bhi sharma jate hain ðŸ˜Œ"
                    },
                    { 
                        sectionId: 'ai-playground',
                        align: 'left',  
                        offsetY: 100,
                        title: "Mera real-time CV demo dekho. No cheating!"
                    },
                    { 
                        sectionId: 'appointment',
                        align: 'right',
                        offsetY: 160,
                        title: "Time book kar lo, recruiter ho ya client!"
                    },
                    { 
                        sectionId: 'gettintouch',
                        align: 'left',  
                        offsetY: 120,
                        title: "Yahan se Ahmad ko ping kar sakte ho ðŸ“©"
                    }
                ];
                
                let stopIndex = 0;
                let hoverCount = 0;
                
                const funnyHoverTitles = [
                    "Oye, gently! Iâ€™m a delicate model.", 
                    "Aap clearly procrastinate kar rahe ho ðŸ˜", 
                    "Bus karo bhai, main GitHub issue file kar doonga!"
                ];

                function moveRobotToCurrentStop() {
                    const stop = robotStops[stopIndex];
                    const section = document.getElementById(stop.sectionId);
                    if (!section) return;

                    robot.title = stop.title; 
                    hoverCount = 0; 

                    const rect = section.getBoundingClientRect();
                    const viewTop = window.scrollY;
                    const absoluteY = viewTop + rect.top + stop.offsetY;
                    const topInViewport = absoluteY - window.scrollY;
                    const clampedTop = Math.max(80, Math.min(window.innerHeight - 120, topInViewport));

                    robot.style.top = clampedTop + 'px';
                    robot.style.bottom = '';
                    robot.style.left = '';
                    robot.style.right = '';

                    if (stop.align === 'left') {
                        robot.style.left = '1.2rem';
                    } else {
                        robot.style.right = '1.2rem';
                    }

                    robot.classList.remove('robot-jump');
                    void robot.offsetWidth;
                    robot.classList.add('robot-jump');
                }

                robot.addEventListener('mouseenter', () => {
                    hoverCount++;
                    if (hoverCount === 5) {
                        robot.title = funnyHoverTitles[0];
                    } else if (hoverCount === 10) {
                        robot.title = funnyHoverTitles[1];
                    } else if (hoverCount === 15) {
                        robot.title = funnyHoverTitles[2];
                        hoverCount = 0;
                    } else if (hoverCount > 1) {
                        if (robotStops[stopIndex]) {
                           robot.title = robotStops[stopIndex].title;
                        }
                    }
                });
                
                setTimeout(moveRobotToCurrentStop, 700);

                const robotInterval = setInterval(() => {
                    stopIndex = (stopIndex + 1) % robotStops.length;
                    moveRobotToCurrentStop();
                }, 12000);
            }

            // --- Chatbot Logic (unchanged, only using robot click as toggle) ---
            const chatbotPanel = document.getElementById('chatbot-panel');
            const chatbotCloseButton = document.getElementById('chatbot-close-button');
            const chatbotMessages = document.getElementById('chatbot-messages');
            const chatbotForm = document.getElementById('chatbot-form');
            const chatbotInput = document.getElementById('chatbot-input');
            const chatbotSendButton = document.getElementById('chatbot-send-button');
            const voiceButton = document.getElementById('voice-button');

            const aiAvatarImg = document.getElementById('ai-avatar-img');
            const aiStatusEl = document.getElementById('ai-status');
            const aiPulseEl = document.getElementById('ai-avatar-pulse');
            const robotMascot = document.getElementById('floating-robot');

            const GEMINI_API_KEY = "AIzaSyBtbVdWzVOFViP9oMEyjDEQXY_Chj_P9_U";
            const GEMINI_TEXT_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`;
            const GEMINI_TTS_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${GEMINI_API_KEY}`;

            const PROFILE_SUMMARY = `
                Ahmad Makki is an AI/ML Engineer based in Lahore, Pakistan, with an MS in Data Science from PUCIT and a B.Sc in Electrical Engineering from UET Lahore.
                Specializes in: Computer Vision (YOLO, Roboflow), Natural Language Processing (NLP), Large Language Models (LLMs like GPT, Mistral), LLM App Development, MLOps (Docker, Kubernetes, FastAPI deployment), Python (Pandas, NumPy, Scikit-learn), SQL, and Automation (n8n).
                Experience: Currently Associate AI/ML Engineer at Scraperrs Lab (since Feb 2025), previously interned at Machine Learning 1 Limited and Descon. Experience includes building CV inference APIs, RAG systems, chatbots, predictive models, and deploying models using Docker and Kubernetes.
                Projects: Smart Conversational Agent for Mental Health, RAG PDF Query System, Kubernetes ML Deployment, Predictive Student Score Modeling, Real-time CV Inference API.
                Contact: WhatsApp at +92 304 2725542 or email at makkia52@gmail.com. Open to opportunities and collaborations.
            `.trim().replace(/\s+/g, ' ');

            let messages = [
                { role: "assistant", content: "Hi there! Ask me anything about Ahmad's skills, experience, or projects." }
            ];
            let isSpeaking = false;
            let currentAudio = null;

            const toggleChatbot = () => {
                chatbotPanel.classList.toggle('hidden');
                if (!chatbotPanel.classList.contains('hidden')) {
                    chatbotInput.focus();
                } else {
                    if (currentAudio) {
                        currentAudio.pause();
                        isSpeaking = false;
                        aiAvatarImg.classList.remove('ai-speaking');
                        setAIDoneSpeaking();
                    }
                }
            };

            if (robotMascot) {
                robotMascot.addEventListener('click', toggleChatbot); 
            }
            chatbotCloseButton.addEventListener('click', toggleChatbot);

            chatbotPanel.classList.remove('hidden');
            setTimeout(() => chatbotInput.focus(), 100);

            function renderMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('flex');

                const bubble = document.createElement('div');
                bubble.textContent = message.content;
                bubble.classList.add('rounded-lg', 'px-3', 'py-2', 'max-w-[80%]', 'text-sm', 'whitespace-pre-wrap');

                if (message.role === 'user') {
                    bubble.classList.add('self-end', 'bg-cyan-500', 'text-slate-900');
                    messageDiv.classList.add('justify-end');
                } else {
                    bubble.classList.add('self-start', 'bg-slate-800', 'text-slate-200', 'border', 'border-slate-700');
                    if (message.isError) {
                        bubble.classList.add('border-red-500/50', 'text-red-300');
                    }
                }
                
                messageDiv.appendChild(bubble);
                chatbotMessages.appendChild(messageDiv);
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            }

            function renderAssistantStreaming(fullText) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('flex');

                const bubble = document.createElement('div');
                bubble.classList.add(
                    'self-start', 'bg-slate-800', 'text-slate-200', 'border',
                    'border-slate-700', 'rounded-lg', 'px-3', 'py-2',
                    'max-w-[80%]', 'text-sm', 'whitespace-pre-wrap'
                );

                messageDiv.appendChild(bubble);
                chatbotMessages.appendChild(messageDiv);
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;

                let idx = 0;
                const speed = 15;
                function step() {
                    if (idx <= fullText.length) {
                        bubble.textContent = fullText.slice(0, idx);
                        idx++;
                        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
                        setTimeout(step, speed);
                    }
                }
                step();
            }

            const showTypingIndicator = () => {
                const typingDiv = document.createElement('div');
                typingDiv.id = 'typing-indicator';
                typingDiv.classList.add('flex');
                typingDiv.innerHTML = `
                    <div class="self-start bg-slate-800 text-slate-400 border border-slate-700 rounded-lg px-3 py-2 max-w-[80%] text-sm">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </div>
                `;
                chatbotMessages.appendChild(typingDiv);
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            };

            const hideTypingIndicator = () => {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) indicator.remove();
            };

            function setAIThinking() {
                aiStatusEl.textContent = "Thinking...";
                aiStatusEl.classList.add("text-cyan-300");
                aiPulseEl.classList.add("ai-thinking");
                if (robotMascot) robotMascot.classList.add('robot-active');
            }
            function setAIOnline() {
                aiStatusEl.textContent = "Online";
                aiStatusEl.classList.remove("text-cyan-300");
                aiPulseEl.classList.remove("ai-thinking");
                if (robotMascot) robotMascot.classList.remove('robot-active');
            }
            function setAISpeaking() {
                aiStatusEl.textContent = "Speaking...";
                aiStatusEl.classList.add("text-cyan-300");
                aiAvatarImg.classList.add('ai-speaking');
                if (robotMascot) robotMascot.classList.add('robot-active');
            }
            function setAIDoneSpeaking() {
                aiStatusEl.textContent = "Online";
                aiStatusEl.classList.remove("text-cyan-300");
                aiAvatarImg.classList.remove('ai-speaking');
                if (robotMascot) robotMascot.classList.remove('robot-active');
            }

            const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            const fetchWithBackoff = async (url, options, maxRetries = 3) => {
                let attempt = 0;
                while (attempt < maxRetries) {
                    try {
                        const response = await fetch(url, options);
                        if (response.ok ||
                            (response.status >= 400 && response.status < 500 && response.status !== 429)) {
                            return response;
                        }
                    } catch (error) {
                        if (attempt === maxRetries - 1) throw error;
                    }
                    
                    attempt++;
                    const delayTime = 1000 * Math.pow(2, attempt - 1);
                    await delay(delayTime);
                }
                throw new Error("Max retries reached");
            };

            const playAudio = (text) => {
                return new Promise(async (resolve, reject) => {
                    if (isSpeaking && currentAudio) {
                        currentAudio.pause();
                        isSpeaking = false;
                    }
                    
                    setAISpeaking();
                    
                    try {
                        const ttsPayload = {
                            contents: [{ parts: [{ text: `Say cheerfully: ${text}` }] }],
                            generationConfig: {
                                responseModalities: ["AUDIO"],
                                speechConfig: {
                                    voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } }
                                }
                            },
                            model: "gemini-2.5-flash-preview-tts"
                        };

                        const response = await fetchWithBackoff(GEMINI_TTS_API_URL, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(ttsPayload)
                        });

                        const data = await response.json();

                        if (!response.ok) {
                            console.error("TTS API error:", data);
                            throw new Error(data.error?.message || "TTS Request Failed");
                        }

                        const part = data?.candidates?.[0]?.content?.parts?.[0];
                        const audioData = part?.inlineData?.data;
                        const mimeType = part?.inlineData?.mimeType;

                        if (audioData && mimeType && mimeType.startsWith("audio/")) {
                            const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                            const pcmData = base64ToArrayBuffer(audioData);
                            const wavBlob = pcmToWav(pcmData, sampleRate);
                            const audioUrl = URL.createObjectURL(wavBlob);
                            
                            currentAudio = new Audio(audioUrl);
                            isSpeaking = true;
                            
                            currentAudio.onended = () => {
                                isSpeaking = false;
                                setAIDoneSpeaking();
                                resolve();
                            };
                            
                            currentAudio.onerror = (e) => {
                                console.error("Error playing audio:", e);
                                isSpeaking = false;
                                setAIDoneSpeaking();
                                reject(e);
                            };

                            currentAudio.play();
                        } else {
                            throw new Error("No valid audio data in TTS response.");
                        }
                    } catch (err) {
                        console.error("Error in playAudio:", err);
                        setAIDoneSpeaking();
                        reject(err);
                    }
                });
            };

            const fetchGeminiResponse = async (userQuery) => {
                showTypingIndicator();
                setAIThinking();
                chatbotSendButton.disabled = true;

                if (!GEMINI_API_KEY || GEMINI_API_KEY === "YOUR_NEW_API_KEY_GOES_HERE") {
                    hideTypingIndicator();
                    setAIOnline();
                    renderMessage({ role: 'assistant', content: "Chatbot not configured (Missing API key).", isError: true });
                    chatbotSendButton.disabled = false;
                    return;
                }

                const prompt = `You are Ahmad Makkiâ€™s portfolio assistant. Answer only using the following profile summary and do not invent information. Keep answers concise. PROFILE: ${PROFILE_SUMMARY}. USER QUESTION: ${userQuery}`;

                const requestOptions = {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [ { role: "user", parts: [{ text: prompt }] } ],
                    }),
                };

                try {
                    const response = await fetchWithBackoff(GEMINI_TEXT_API_URL, requestOptions);
                    const data = await response.json();

                    hideTypingIndicator();
                    setAIOnline(); 

                    if (!response.ok) {
                        console.error("Gemini API error:", data);
                        let errorMsg = `Request failed with status ${response.status}`;
                        if (data.error?.message) {
                           errorMsg = data.error.message;
                           if (errorMsg.includes("API_KEY_HTTP_REFERRER_BLOCKED") || errorMsg.includes("Requests from referer") ) {
                               errorMsg = "Error: This website domain is not authorized to use the API key. Please check the key restrictions in Google Cloud Console.";
                           }
                        } 
                        throw new Error(errorMsg);
                    }

                    const text = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim();

                    if (text) {
                        const assistantMessage = { role: "assistant", content: text };
                        messages.push(assistantMessage);
                        renderAssistantStreaming(text);
                        await playAudio(text);
                    } else {
                        console.error("Unexpected response structure:", data);
                        throw new Error("Empty or invalid response structure from model.");
                    }
                } catch (err) {
                    console.error("Error in fetchGeminiResponse:", err);
                    hideTypingIndicator();
                    setAIOnline();
                    
                    const displayError = err.message.startsWith("Error:") ? err.message : 
                        "Sorry, I couldnâ€™t reach the AI right now. Please try again later or contact Ahmad directly.";
                    
                    const errorMessage = {
                        role: "assistant",
                        content: displayError,
                        isError: true,
                    };
                    messages.push(errorMessage);
                    renderMessage(errorMessage);
                } finally {
                    setAIOnline();
                    chatbotSendButton.disabled = false;
                    if (!recognizing) chatbotInput.focus();
                }
            };

            document.querySelectorAll('.ai-suggestion').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const q = btn.textContent.trim();
                    renderMessage({ role: 'user', content: q });
                    messages.push({ role: 'user', content: q }); 
                    chatbotInput.value = "";
                    await fetchGeminiResponse(q);
                });
            });

            chatbotForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userInput = chatbotInput.value.trim();
                if (!userInput || isSpeaking) return;

                renderMessage({ role: 'user', content: userInput });
                messages.push({ role: 'user', content: userInput });
                
                chatbotInput.value = '';
                await fetchGeminiResponse(userInput);
            });

            let recognizing = false;
            let recognition;

            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.lang = 'en-US';
                recognition.interimResults = true;
                recognition.continuous = false;

                recognition.onstart = () => {
                    recognizing = true;
                    voiceButton.classList.add('bg-cyan-500','text-slate-900');
                    voiceButton.classList.remove('bg-slate-700','text-slate-200');
                    chatbotInput.placeholder = "Listening...";
                };

                recognition.onend = () => {
                    recognizing = false;
                    voiceButton.classList.remove('bg-cyan-500','text-slate-900');
                    voiceButton.classList.add('bg-slate-700','text-slate-200');
                    chatbotInput.placeholder = "Ask a question...";
                };
                
                recognition.onerror = (event) => {
                    console.error("Speech recognition error:", event.error);
                    chatbotInput.placeholder = "Voice error. Try typing.";
                };

                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    let finalTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript;
                        } else {
                            interimTranscript += event.results[i][0].transcript;
                        }
                    }
                    chatbotInput.value = finalTranscript || interimTranscript; 
                    if (finalTranscript) {
                        chatbotForm.requestSubmit(); 
                    }
                };

                voiceButton.addEventListener('click', () => {
                    if (recognizing) {
                        recognition.stop();
                    } else {
                        if (isSpeaking && currentAudio) {
                            currentAudio.pause();
                        }
                        try {
                           recognition.start();
                        } catch (e) {
                           console.error("Could not start recognition:", e);
                           chatbotInput.placeholder = "Voice input failed to start.";
                        }
                    }
                });
            } else {
                voiceButton.disabled = true;
                voiceButton.title = "Voice not supported in this browser";
                voiceButton.classList.add("opacity-40","cursor-not-allowed");
            }
            
            // --- AI Playground Logic: Webcam + COCO-SSD (unchanged) ---
            const video = document.getElementById('webcam-feed');
            const canvas = document.getElementById('detection-canvas');
            const button = document.getElementById('webcam-button');
            const status = document.getElementById('model-status');
            const ctx = canvas.getContext('2d');
            let model = null;
            let animationFrameId = null;

            async function loadModel() {
                if (model) return model;
                status.textContent = 'Loading AI model (coco-ssd)...';
                try {
                    model = await cocoSsd.load();
                    status.textContent = 'Model loaded. Ready to detect!';
                } catch (err) {
                    console.error("Failed to load model:", err);
                    status.textContent = 'Error: Failed to load AI model.';
                }
                return model;
            }

            async function startWebcam() {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    status.textContent = 'Error: Webcam not supported by your browser.';
                    return;
                }
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        'video': { 
                            width: { ideal: 640 }, 
                            height: { ideal: 480 },
                            facingMode: 'user' 
                        } 
                    });
                    video.srcObject = stream;
                    video.onloadedmetadata = () => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        status.textContent = 'Webcam active. Detecting...';
                        runDetection();
                    };
                } catch (err) {
                    console.error("Error accessing webcam:", err);
                    status.textContent = 'Error: Could not access webcam.';
                }
            }

            async function runDetection() {
                if (!model) {
                    return;
                }
                
                const predictions = await model.detect(video);
                
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                
                ctx.font = '14px Inter, sans-serif';
                ctx.textBaseline = 'top';

                predictions.forEach(prediction => {
                    const [x, y, width, height] = prediction.bbox;
                    ctx.strokeStyle = '#06b6d4';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x, y, width, height);
                    
                    const label = `${prediction.class} (${Math.round(prediction.score * 100)}%)`;
                    const textWidth = ctx.measureText(label).width;
                    ctx.fillStyle = '#06b6d4';
                    ctx.fillRect(x, y, textWidth + 8, 20);
                    ctx.fillStyle = '#0f172a';
                    ctx.fillText(label, x + 4, y + 4);
                });
                
                animationFrameId = requestAnimationFrame(runDetection);
            }

            button.addEventListener('click', async () => {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                    if (video.srcObject) {
                        video.srcObject.getTracks().forEach(track => track.stop());
                    }
                    video.srcObject = null;
                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                    button.textContent = 'Start Webcam';
                    status.textContent = 'Webcam stopped.';
                } else {
                    button.textContent = 'Stop Webcam';
                    status.textContent = 'Initializing...';
                    await loadModel();
                    await startWebcam();
                }
            });

            // --- NEW: Extra AI demos (MobileNet, Toxicity, USE) ---

            // 1) Image Classification (MobileNet)
            const classifyInput = document.getElementById('classify-image-input');
            const classifyPreview = document.getElementById('classify-image-preview');
            const classifyButton = document.getElementById('classify-image-button');
            const classifyResult = document.getElementById('classify-image-result');

            let mobilenetModel = null;

            async function loadMobileNetModel() {
                if (!mobilenetModel) {
                    classifyResult.textContent = "Loading MobileNet model...";
                    mobilenetModel = await mobilenet.load();
                }
                return mobilenetModel;
            }

            if (classifyInput) {
                classifyInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (!file) {
                        classifyPreview.classList.add('hidden');
                        classifyResult.textContent = "";
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        classifyPreview.src = ev.target.result;
                        classifyPreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                });
            }

            if (classifyButton) {
                classifyButton.addEventListener('click', async () => {
                    if (!classifyPreview || classifyPreview.classList.contains('hidden')) {
                        classifyResult.textContent = "Please select an image first.";
                        return;
                    }
                    classifyButton.disabled = true;
                    classifyResult.textContent = "Thinking...";
                    try {
                        const model = await loadMobileNetModel();
                        const predictions = await model.classify(classifyPreview);
                        if (predictions && predictions.length > 0) {
                            const top = predictions[0];
                            classifyResult.textContent = `Top guess: ${top.className} (${(top.probability * 100).toFixed(1)}% confidence)`;
                        } else {
                            classifyResult.textContent = "No prediction returned.";
                        }
                    } catch (err) {
                        console.error("Error in MobileNet classification:", err);
                        classifyResult.textContent = "Error: Could not classify this image.";
                    } finally {
                        classifyButton.disabled = false;
                    }
                });
            }

            // 2) Tone Analyzer (Toxicity model)
            const toneInput = document.getElementById('tone-input');
            const toneButton = document.getElementById('tone-analyze-button');
            const toneResult = document.getElementById('tone-result');

            let toxicityModel = null;

            async function loadToxicityModel() {
                if (!toxicityModel) {
                    toneResult.textContent = "Loading toxicity model...";
                    // default threshold ~0.85 is fine
                    toxicityModel = await toxicity.load(0.85);
                }
                return toxicityModel;
            }

            if (toneButton) {
                toneButton.addEventListener('click', async () => {
                    const text = (toneInput.value || "").trim();
                    if (!text) {
                        toneResult.textContent = "Please type something to analyze.";
                        return;
                    }
                    toneButton.disabled = true;
                    toneResult.textContent = "Analyzing tone...";
                    try {
                        const model = await loadToxicityModel();
                        const predictions = await model.classify([text]);
                        const triggeredLabels = [];
                        predictions.forEach(pred => {
                            if (pred.results[0].match) {
                                triggeredLabels.push(pred.label);
                            }
                        });

                        if (triggeredLabels.length === 0) {
                            toneResult.textContent = "Tone looks mostly neutral / non-toxic âœ…";
                        } else {
                            toneResult.textContent = `Careful: model flagged possible "${triggeredLabels.join(', ')}" in this sentence.`;
                        }
                    } catch (err) {
                        console.error("Error in toxicity analysis:", err);
                        toneResult.textContent = "Error: Could not analyze tone.";
                    } finally {
                        toneButton.disabled = false;
                    }
                });
            }

            // 3) Smart Topic Router (Universal Sentence Encoder)
            const routeInput = document.getElementById('route-input');
            const routeButton = document.getElementById('route-button');
            const routeResult = document.getElementById('route-result');

            let useModel = null;
            let skillEmbeddings = null;

            const skillTopics = [
                {
                    label: "Computer Vision & CV APIs",
                    text: "object detection, yolo, computer vision, opencv, images, video, camera, bounding boxes, segmentation, shelf analytics"
                },
                {
                    label: "LLMs, NLP & RAG",
                    text: "language model, chatbot, RAG, embeddings, NLP, text, prompts, question answering, generative AI, mental health chatbot"
                },
                {
                    label: "MLOps & Deployment",
                    text: "docker, kubernetes, k8s, devops, deployment, fastapi, scaling, servers, CI CD, ML pipelines"
                }
            ];

            async function ensureUSEAndEmbeddings() {
                if (!useModel) {
                    routeResult.textContent = "Loading sentence encoder...";
                    useModel = await use.load();
                }
                if (!skillEmbeddings) {
                    const phrases = skillTopics.map(s => s.text);
                    const skillTensor = await useModel.embed(phrases); // [3, dim]
                    skillEmbeddings = await skillTensor.array();       // [[...],[...],[...]]
                    skillTensor.dispose();
                }
            }

            function cosineSimilarity(a, b) {
                let dot = 0, na = 0, nb = 0;
                for (let i = 0; i < a.length; i++) {
                    dot += a[i] * b[i];
                    na += a[i] * a[i];
                    nb += b[i] * b[i];
                }
                if (!na || !nb) return 0;
                return dot / (Math.sqrt(na) * Math.sqrt(nb));
            }

            if (routeButton) {
                routeButton.addEventListener('click', async () => {
                    const text = (routeInput.value || "").trim();
                    if (!text) {
                        routeResult.textContent = "Please type a question or a project idea.";
                        return;
                    }
                    routeButton.disabled = true;
                    routeResult.textContent = "Thinking...";
                    try {
                        await ensureUSEAndEmbeddings();
                        const userTensor = await useModel.embed([text]); // [1, dim]
                        const userArr = (await userTensor.array())[0];
                        userTensor.dispose();

                        let bestIdx = 0;
                        let bestScore = -1;
                        skillEmbeddings.forEach((emb, idx) => {
                            const sim = cosineSimilarity(userArr, emb);
                            if (sim > bestScore) {
                                bestScore = sim;
                                bestIdx = idx;
                            }
                        });

                        const bestTopic = skillTopics[bestIdx];
                        routeResult.textContent = `This sounds most related to: ${bestTopic.label} (similarity ${(bestScore * 100).toFixed(1)}%).`;
                    } catch (err) {
                        console.error("Error in topic routing:", err);
                        routeResult.textContent = "Error: Could not route this question.";
                    } finally {
                        routeButton.disabled = false;
                    }
                });
            }

        });
    </script>

</body>
</html>
